รายละเอียดการทำงานของโค้ด
โค้ดนี้มีหน้าที่ในการอ่านและจัดการฟิลด์ต่าง ๆ ที่อยู่ในไฟล์ PDF รวมถึงการสร้างไฟล์ PDF ใหม่ที่มีข้อมูลจาก data_fields มาแทรกลงในฟิลด์ต่าง ๆ ของไฟล์ต้นฉบับ แล้วรวมไฟล์ PDF ที่มีข้อมูลเข้ากับไฟล์เทมเพลตเดิม

ขั้นตอนการทำงาน
ค้นหาฟิลด์ใน PDF
ใช้ฟังก์ชัน find_form_fields(pdf_path) เพื่อค้นหาฟิลด์ในไฟล์ PDF โดยใช้ไลบรารี fitz (PyMuPDF) ทำการค้นหาฟิลด์ต่าง ๆ เช่น ช่องกรอกข้อความ, เช็คบ็อกซ์, ปุ่มตัวเลือก และจะระบุตำแหน่ง (พิกัด) และขนาดของแต่ละฟิลด์ลงในรายการ form_fields พร้อมแก้ไขชื่อฟิลด์หากพบชื่อซ้ำกัน

การเปลี่ยนชื่อฟิลด์
ฟังก์ชัน change_field_name ใช้สำหรับเปลี่ยนชื่อฟิลด์ที่มีชื่อซ้ำกัน เช่นในกรณีที่มีเช็คบ็อกซ์หลายตัวที่ใช้ชื่อเดียวกัน จะเพิ่มเลขต่อท้ายชื่อเช่น field_1, field_2 เพื่อให้สามารถแยกได้

สร้างไฟล์ PDF ที่มีข้อมูลแทรกลงในฟิลด์
ฟังก์ชัน create_pdf_with_data ใช้สร้างไฟล์ PDF ที่นำข้อมูลจาก data_fields ไปแทรกลงในตำแหน่งฟิลด์ที่กำหนดในไฟล์ PDF โดยมีการจัดรูปแบบข้อความ, รูปภาพ และเช็คบ็อกซ์ตามข้อมูลที่ระบุ

การประมวลผลฟิลด์เช็คบ็อกซ์ที่ซ้ำกัน
ฟังก์ชัน process_data_fields ใช้สำหรับจัดการค่าฟิลด์ที่ซ้ำกัน โดยเฉพาะฟิลด์ที่เป็นเช็คบ็อกซ์ เพื่อให้ฟิลด์หลักและฟิลด์ย่อยที่มี suffix (เช่น _1, _2) ทำงานสัมพันธ์กัน

การรวม PDF เทมเพลตกับ PDF ข้อมูล
ฟังก์ชัน merge_pages ใช้สำหรับรวมไฟล์ PDF ที่มีข้อมูลที่แทรกลงในฟิลด์กับไฟล์เทมเพลตต้นฉบับเข้าด้วยกัน โดยหน้าของทั้งสองไฟล์จะถูกซ้อนทับและรวมเป็นไฟล์เดียว

ฟังก์ชันหลัก (main)

กำหนดไฟล์ PDF เทมเพลต
เรียกใช้ฟังก์ชัน find_form_fields เพื่อค้นหาฟิลด์
เรียกใช้ฟังก์ชัน create_pdf_with_data เพื่อสร้าง PDF ที่มีข้อมูล
รวม PDF เทมเพลตกับ PDF ข้อมูลโดยใช้ฟังก์ชัน merge_pages
วิธีการใช้งาน
เตรียมไฟล์ PDF เทมเพลตที่มีฟิลด์ (ฟิลด์ที่สร้างขึ้นจากโปรแกรม Adobe Acrobat หรือโปรแกรมอื่น ๆ ที่รองรับ)
กำหนดข้อมูลที่ต้องการแทรกลงในฟิลด์ต่าง ๆ ในตัวแปร data_fields
รันโปรแกรมโดยเรียกใช้ฟังก์ชัน main() ซึ่งจะสร้างไฟล์ PDF ที่มีข้อมูลและรวมเข้ากับเทมเพลตต้นฉบับ
ไลบรารีที่ใช้
fitz (PyMuPDF) สำหรับการจัดการ PDF เช่นการอ่านและแก้ไขฟิลด์
FPDF สำหรับการสร้างและจัดรูปแบบไฟล์ PDF
os สำหรับการจัดการไฟล์ในระบบ
โครงสร้างไฟล์
pdf_path : เส้นทางของไฟล์ PDF เทมเพลต
output_path : เส้นทางของไฟล์ PDF ที่สร้างขึ้นมาใหม่
merged_output_path : เส้นทางของไฟล์ PDF ที่รวมแล้ว
ข้อควรระวัง
ฟิลด์ในไฟล์ PDF เทมเพลตควรมีชื่อที่แตกต่างกัน หากมีฟิลด์ชื่อซ้ำกันต้องตรวจสอบการตั้งค่าให้ถูกต้อง
ควรตรวจสอบข้อมูลใน data_fields ให้ตรงกับฟิลด์ในเทมเพลต
